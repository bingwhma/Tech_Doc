# Kafka作为一个分布式的流平台

流处理平台具有三个关键能力：

    发布和订阅消息(流)，在这方面，它类似于一个消息队列。
    以容错(故障转移)的方式存储消息(流)。
    在消息流发生时处理它们。

# 什么是kafka的优势？它主要应用于2大类应用：

    构建实时的流数据管道，可靠地获取系统和应用程序之间的数据。
    构建实时流的应用程序，对数据流进行转换或反应。

# 首先几个概念：

    kafka作为一个集群运行在一个或多个服务器上。
    kafka集群存储的消息是以topic为类别记录的。
    每个消息（也叫记录record，我习惯叫消息）是由一个key，一个value和时间戳构成。

# kafka有四个核心API

    应用程序使用 Producer API 发布消息到1个或多个topic（主题）中。
    应用程序使用 Consumer API 来订阅一个或多个topic，并处理产生的消息。
    应用程序使用 Streams API 充当一个流处理器，从1个或多个topic消费输入流，并生产一个输出流到1个或多个输出topic，有效地将输入流转换到输出流。
    Connector API 可构建或运行可重用的生产者或消费者，将topic连接到现有的应用程序或数据系统。例如，连接到关系数据库的连接器可以捕获表的每个变更。

# 基本术语
## Topic
Kafka将消息分门别类，每一类的消息称之为一个主题（Topic）。

## Producer
发布消息的对象称之为主题生产者（Kafka topic producer）

## Consumer
订阅消息并处理发布的消息的对象称之为主题消费者（consumers）

## Broker
已发布的消息保存在一组服务器中，称之为Kafka集群。集群中的每一个服务器都是一个代理（Broker）。 消费者可以订阅一个或多个主题（topic），并从Broker拉数据，从而消费这些已发布的消息。

## 主题和日志 （Topic和Log）
Topic是发布的消息的类别名，一个topic可以有零个，一个或多个消费者订阅该主题的消息。
对于每个topic，Kafka集群都会维护一个分区log

## 分布式(Distribution)

Log的分区被分布到集群中的多个服务器上。每个服务器处理它分到的分区。 根据配置每个分区还可以复制到其它服务器作为备份容错。 每个分区有一个leader，零或多个follower。Leader处理此分区的所有的读写请求，
而follower被动的复制数据。如果leader宕机，其它的一个follower会被推举为新的leader。 一台服务器可能同时是一个分区的leader，另一个分区的follower。 这样可以平衡负载，避免所有的请求都只让一台或者某几台服务器处理。

## Geo-Replication(异地数据同步技术)

Kafka MirrorMaker为群集提供geo-replication支持。借助MirrorMaker，消息可以跨多个数据中心或云区域进行复制。 您可以在active/passive场景中用于备份和恢复; 
或者在active/passive方案中将数据置于更接近用户的位置，或数据本地化。

## 生产者(Producers)

生产者往某个Topic上发布消息。生产者也负责选择发布到Topic上的哪一个分区。最简单的方式从分区列表中轮流选择。也可以根据某种算法依照权重选择分区。开发者负责如何选择分区的算法。

## 消费者(Consumers)

通常来讲，消息模型可以分为两种， 队列和发布-订阅式。 队列的处理方式是 一组消费者从服务器读取消息，一条消息只有其中的一个消费者来处理。在发布-订阅模型中，消息被广播给所有的消费者，接收到消息的消费者都可以处理此消息。
Kafka为这两种模型提供了单一的消费者抽象模型： 消费者组 （consumer group）。 消费者用一个消费者组名标记自己。 
一个发布在Topic上消息被分发给此消费者组中的一个消费者。 假如所有的消费者都在一个组中，那么这就变成了queue模型。
